<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Auditor√≠a - Sistema de Gesti√≥n</title>
    <link rel="stylesheet" href="../css/styles.css">
</head>
<body>
    <!-- Navbar se inyecta aqu√≠ -->
    <div id="navbar-container"></div>

    <main class="container">
        <header class="page-header fade-in">
            <div>
                <h1>üìä Auditor√≠a y Reportes</h1>
                <p>Historial completo de operaciones del sistema</p>
            </div>
        </header>

        <!-- ============================================ -->
        <!-- SECCI√ìN: INSTRUCCIONES -->
        <!-- ============================================ -->
        <section class="info-box fade-in" style="animation-delay: 0.1s;">
            <h3>üìã Instrucciones</h3>
            <ul>
                <li><strong>Auditor√≠a autom√°tica:</strong> Todas las operaciones (crear, actualizar, eliminar) quedan registradas autom√°ticamente</li>
                <li><strong>Filtros combinables:</strong> Puedes combinar filtros por grupo, tabla, operaci√≥n y rango de fechas</li>
                <li><strong>Comparaci√≥n de cambios:</strong> Al hacer clic en una fila, puedes ver qu√© datos cambiaron (antes/despu√©s)</li>
                <li><strong>Exportar reportes:</strong> Genera reportes en CSV para an√°lisis en Excel</li>
            </ul>
        </section>

        <!-- ============================================ -->
        <!-- SECCI√ìN: FILTROS -->
        <!-- ============================================ -->
        <section class="filtros-section fade-in" style="animation-delay: 0.2s;">
            <div class="card">
                <h3>üîç Filtros de B√∫squeda</h3>

                <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 1rem; margin-top: 1rem;">
                    <!-- Filtro por grupo -->
                    <div class="form-group">
                        <label class="form-label" for="filtro-grupo">Grupo Estudiantes</label>
                        <select id="filtro-grupo" class="form-select" onchange="filtrarAuditoria()">
                            <option value="">Todos los grupos</option>
                        </select>
                    </div>

                    <!-- Filtro por tabla -->
                    <div class="form-group">
                        <label class="form-label" for="filtro-tabla">Tabla</label>
                        <select id="filtro-tabla" class="form-select" onchange="filtrarAuditoria()">
                            <option value="">Todas las tablas</option>
                            <option value="productos">Productos</option>
                            <option value="clientes">Clientes</option>
                        </select>
                    </div>

                    <!-- Filtro por operaci√≥n -->
                    <div class="form-group">
                        <label class="form-label" for="filtro-operacion">Operaci√≥n</label>
                        <select id="filtro-operacion" class="form-select" onchange="filtrarAuditoria()">
                            <option value="">Todas las operaciones</option>
                            <option value="INSERT">‚úÖ Inserci√≥n (CREATE)</option>
                            <option value="UPDATE">‚úèÔ∏è Actualizaci√≥n (UPDATE)</option>
                            <option value="DELETE">üóëÔ∏è Eliminaci√≥n (DELETE)</option>
                        </select>
                    </div>

                    <!-- Filtro por fecha desde -->
                    <div class="form-group">
                        <label class="form-label" for="filtro-fecha-desde">Desde</label>
                        <input
                            type="date"
                            id="filtro-fecha-desde"
                            class="form-input"
                            onchange="filtrarAuditoria()"
                        >
                    </div>

                    <!-- Filtro por fecha hasta -->
                    <div class="form-group">
                        <label class="form-label" for="filtro-fecha-hasta">Hasta</label>
                        <input
                            type="date"
                            id="filtro-fecha-hasta"
                            class="form-input"
                            onchange="filtrarAuditoria()"
                        >
                    </div>
                </div>

                <div style="display: flex; gap: 1rem; margin-top: 1rem;">
                    <button class="btn btn-secondary" onclick="limpiarFiltros()">
                        üîÑ Limpiar Filtros
                    </button>
                    <button class="btn btn-success" onclick="exportarAuditoriaCSV()">
                        üì• Exportar a CSV
                    </button>
                </div>
            </div>
        </section>

        <!-- ============================================ -->
        <!-- SECCI√ìN: ESTAD√çSTICAS -->
        <!-- ============================================ -->
        <section class="stats-grid fade-in" style="animation-delay: 0.3s;">
            <div class="stat-card">
                <div class="stat-icon">üìù</div>
                <div class="stat-content">
                    <span class="stat-label">Total Operaciones</span>
                    <span class="stat-value" id="stat-total-operaciones">0</span>
                </div>
            </div>

            <div class="stat-card">
                <div class="stat-icon" style="background-color: var(--color-exito);">‚úÖ</div>
                <div class="stat-content">
                    <span class="stat-label">Inserciones</span>
                    <span class="stat-value" id="stat-inserciones">0</span>
                </div>
            </div>

            <div class="stat-card">
                <div class="stat-icon" style="background-color: var(--color-advertencia);">‚úèÔ∏è</div>
                <div class="stat-content">
                    <span class="stat-label">Actualizaciones</span>
                    <span class="stat-value" id="stat-actualizaciones">0</span>
                </div>
            </div>

            <div class="stat-card">
                <div class="stat-icon" style="background-color: var(--color-peligro);">üóëÔ∏è</div>
                <div class="stat-content">
                    <span class="stat-label">Eliminaciones</span>
                    <span class="stat-value" id="stat-eliminaciones">0</span>
                </div>
            </div>
        </section>

        <!-- ============================================ -->
        <!-- SECCI√ìN: TABLA DE AUDITOR√çA -->
        <!-- ============================================ -->
        <section class="tabla-section fade-in" style="animation-delay: 0.4s;">
            <div class="card">
                <div class="card-header">
                    <h3>üìú Historial de Operaciones</h3>
                    <span id="contador-resultados" style="color: var(--texto-secundario);">
                        Cargando...
                    </span>
                </div>

                <div class="table-responsive">
                    <table class="table">
                        <thead>
                            <tr>
                                <th>ID</th>
                                <th>Fecha/Hora</th>
                                <th>Grupo</th>
                                <th>Tabla</th>
                                <th>Operaci√≥n</th>
                                <th>ID Registro</th>
                                <th>Datos Antiguos</th>
                                <th>Datos Nuevos</th>
                            </tr>
                        </thead>
                        <tbody id="tbody-auditoria">
                            <tr>
                                <td colspan="8" class="text-center">
                                    <div class="spinner"></div>
                                    <p>Cargando historial de auditor√≠a...</p>
                                </td>
                            </tr>
                        </tbody>
                    </table>
                </div>
            </div>
        </section>

        <!-- ============================================ -->
        <!-- SECCI√ìN: GR√ÅFICAS (OPCIONAL) -->
        <!-- ============================================ -->
        <section class="graficas-section fade-in" style="animation-delay: 0.5s;">
            <div class="card">
                <h3>üìä Visualizaci√≥n de Actividad</h3>
                <p style="color: var(--texto-secundario); margin-bottom: 1.5rem;">
                    üéØ <strong>RETO 13:</strong> Implementa gr√°ficas usando Chart.js para visualizar la actividad del sistema
                </p>

                <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(300px, 1fr)); gap: 2rem;">
                    <!-- Gr√°fica 1: Operaciones por tipo -->
                    <div>
                        <h4 style="margin-bottom: 1rem;">Operaciones por Tipo</h4>
                        <canvas id="chart-operaciones" style="max-height: 300px;"></canvas>
                    </div>

                    <!-- Gr√°fica 2: Actividad por grupo -->
                    <div>
                        <h4 style="margin-bottom: 1rem;">Actividad por Grupo</h4>
                        <canvas id="chart-grupos" style="max-height: 300px;"></canvas>
                    </div>
                </div>

                <div style="margin-top: 1.5rem; padding: 1rem; background-color: var(--fondo-secundario); border-radius: var(--border-radius);">
                    <strong>üí° Instrucciones para el Reto 13:</strong>
                    <ol style="margin-top: 0.5rem; margin-left: 1.5rem; color: var(--texto-secundario);">
                        <li>Incluir Chart.js: <code>&lt;script src="https://cdn.jsdelivr.net/npm/chart.js"&gt;&lt;/script&gt;</code></li>
                        <li>Procesar datos de auditor√≠a para extraer estad√≠sticas</li>
                        <li>Crear gr√°fica de pastel (pie chart) para operaciones por tipo</li>
                        <li>Crear gr√°fica de barras para actividad por grupo</li>
                        <li>Actualizar gr√°ficas cuando cambien los filtros</li>
                    </ol>
                </div>
            </div>
        </section>

    </main>

    <!-- Scripts -->
    <!-- IMPORTANTE: El orden de carga importa -->

    <!-- 1. Configuraci√≥n -->
    <script src="../js/config.js"></script>

    <!-- 2. Utilidades -->
    <script src="../js/utils/formatters.js"></script>
    <script src="../js/utils/validators.js"></script>
    <script src="../js/utils/ui.js"></script>

    <!-- 3. Servicios de API -->
    <script src="../js/api/auditoria.js"></script>

    <!-- 4. Componentes -->
    <script src="../js/components/navbar.js"></script>
    <script src="../js/components/modal.js"></script>

    <!-- 5. L√≥gica espec√≠fica de esta p√°gina -->
    <script src="../js/pages/auditoria.js"></script>

    <!-- Chart.js (opcional para el RETO 13) -->
    <!-- <script src="https://cdn.jsdelivr.net/npm/chart.js"></script> -->
</body>
</html>
